---
title: Http网络基础
date: 2016-12-10
categories: "Android"
tags: "网络基础"
---
# OSI 的七层模型
![](http://oxr4g4c3v.bkt.clouddn.com/OSImodel.png)

# TCP
TCP的三次握手（建立连接）和四次挥手（断开连接），发生在传输层。
![](http://oxr4g4c3v.bkt.clouddn.com/TCPconnetion.png)
1. 建立连接，形成传输数据的通道。
2. 在连接中进行大数据量传输。
3. 通过三次握手完成连接，是可靠协议。
4. 必须建立连接，占用计算机的处理时间和网络的带宽，效率会稍低。
通过TCP协议传输，得到的是一个顺序的无差错的数据流。在TCP/IP协议中，IP层主要负责网络主机的定位，数据传输的路由，由IP地址可以唯一确定Internet上的一台主机。而TCP层则提供面向应用的可靠的或非可靠的数据传输机制。
TCP就像生活中的打电话：拨号—连接（发连接请求）–连接通路，然后双方说话。
TCP：在线下载、打电话
### 为什么要设计成三次握手和四次挥手
- 假设没有三次握手的话，当客户端发起连接请求时，会发送报文到服务端，当报文在某个网络节点滞留了很久的时候，此时报文已经失效，而对于服务端来讲，它并不知道该报文已经失效，会当做新的连接请求处理，于是向客户端发送确认报文，并继续等待客户端发送数据，而客户端由于报文失效不会再发送数据，此时服务端便处于死锁状态，浪费资源。
利用三次握手建立连接，会在报文失效的时候，客户端不再发送数据，服务端没有接受客户端的确认信息，会释放资源，不会一直等待。
- 
# UDP
1. 将数据及源和目的封装成数据包中，不需要建立连接。
2. 每个数据包的大小要限制在64k内
3. 因无连接，是不可靠协议的。
4. 不需要建立连接，速度快。
UDP就像生活中去寄包裹类似：物品—包装—贴物流单（填写发送信息：IP+端口）–但是填写的地址可能不存在，所以有可能就丢弃了。发生在传输层

# Http 报文简介
HTTP 协议采用 HTTP 报文的形式传递数据，客户端的报文叫做请求报文；服务器端的报文叫做响应报文。既然是报文，那么一定就会有格式：
请求报文（Request）: 请求头（首部） + 空行 + 请求内容
响应报文（Response）: 响应头（首部） + 空行 + 响应内容
1. 请求首部：
Accept：用户代理可处理的媒体类型
Accept-Charset：优先的字符集
Accept-Language：优先的语言（自然语言）
Accept-Encoding：优先的内容编码
If-Modified-Since：比较资源的更新时间
If-Range：资源未更新时发送实体 Byte 的范围请求
Cookie: 设置Cookie（下面会单独讲）
2. 响应首部：
Cache-Control：控制缓存的行为（下面会单独讲）
set-Cookie: 设置Cookie（下面会单独讲）
Location：令客户端重定向至指定 URI
Expires：实体主体过期的日期时间
Last-Modified：资源的最后修改日期时间
Status Code: 响应的状态码（下面会单独讲）


# Cookie、Session 和 Token
1. Cookie、Session 和 Token 都是用来做持久化处理的，目的就是让客户端和服务端相互认识。Http 请求默认是不持久的没有状态的，谁也不认识谁。
2. Cookie: 是存放在客户端的信息，服务器通过响应头 Set-Cookie 字段给客户端，如果 Cookie 已过期一般是会被清楚的，如果 Cookie 没过期下次访问网站还是会通过请求头的 Cookie 字段带给服务器。
3. Session: 是存放在服务器上面的客户端临时信息，用户离开网站是会被清除的。
4. Token（App）”令牌”：用户身份的验证，有点类似于 Cookie ，相对来说更安全，一般流程：
（1） 客户端向服务端申请 Token
（2） 服务端收到请求，会去验证用户信息，签发一个 Token 给客户端，服务端自己也会保存 Token
（3） 客户端收到服务端签发的 Token 会保存起来，每次请求带上 Token
（4） 服务器收到其他请求，会去验证客户端的 Token , 如果成功返回数据，不成功啥都不给或者做其他处理
# Http 缓存
Cache-Control（缓存策略）：Public、private、no-cache、max-age 、no-store（不缓存）
Expires（缓存的过期策略）：指名了缓存数据有效的绝对时间，告诉客户端到了这个时间点（比照客户端时间点）后本地缓存就作废了，在这个时间点内客户端可以认为缓存数据有效，可直接从缓存中加载展示。

# Http状态码
1xx: Infomational (信息状态码) ，接收的请求正在处理
2xx: Succeed(成功)，请求正常处理完毕,如 200，204
3xx: Redirection(重定向)，需要进行附加操作，一般是没有响应数据返回的，如 304（Not,modified）307
4xx: Client Error (客户端的错误)，服务器无法处理请求，如 404，405
5xx: Server Error (服务端的错误)，服务器处理请求出错，如 500，502

# Http 和 Https 的区别
Https = Http + 加密 + 验证 + 完整
Http 的缺点：
1 数据是没有加密传输，可能会遭遇窃听；
2 不验证通信方的身份，可能会遭遇伪装；
3 无法验证报文的完整性，可能会遭遇篡改。
